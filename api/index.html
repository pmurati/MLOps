
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A quick overview of the source code, used in the MLOps Pipeline.">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.4">
    
    
      
        <title>API - MLOps Source Code</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="grey">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MLOps Source Code" class="md-header__button md-logo" aria-label="MLOps Source Code" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MLOps Source Code
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MLOps Source Code" class="md-nav__button md-logo" aria-label="MLOps Source Code" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MLOps Source Code
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Start
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    Report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.report.visualize" class="md-nav__link">
    src.report.visualize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.report.visualize.plot_confusion_matrix" class="md-nav__link">
    plot_confusion_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stages" class="md-nav__link">
    Stages
  </a>
  
    <nav class="md-nav" aria-label="Stages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-load" class="md-nav__link">
    Data Load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_load" class="md-nav__link">
    src.stages.data_load
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_load.data_load" class="md-nav__link">
    data_load()
  </a>
  
    <nav class="md-nav" aria-label="data_load()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-split" class="md-nav__link">
    Data Split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_split" class="md-nav__link">
    src.stages.data_split
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_split.data_split" class="md-nav__link">
    data_split()
  </a>
  
    <nav class="md-nav" aria-label="data_split()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    Evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.evaluate" class="md-nav__link">
    src.stages.evaluate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.evaluate.evaluate_model" class="md-nav__link">
    evaluate_model()
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#featurize" class="md-nav__link">
    Featurize
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.featurize" class="md-nav__link">
    src.stages.featurize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.featurize.featurize" class="md-nav__link">
    featurize()
  </a>
  
    <nav class="md-nav" aria-label="featurize()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#train" class="md-nav__link">
    Train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.train" class="md-nav__link">
    src.stages.train
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.train.train_model" class="md-nav__link">
    train_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-submodule" class="md-nav__link">
    Train Submodule
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train" class="md-nav__link">
    src.train.train
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train.get_supported_estimator" class="md-nav__link">
    get_supported_estimator()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train.train" class="md-nav__link">
    train()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
    <nav class="md-nav" aria-label="Utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs" class="md-nav__link">
    src.utils.logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs.get_console_handler" class="md-nav__link">
    get_console_handler()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
    <nav class="md-nav" aria-label="get_logger()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mlflow-decorator" class="md-nav__link">
    MLFlow Decorator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.mlflow_run_decorator" class="md-nav__link">
    src.utils.mlflow_run_decorator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.mlflow_run_decorator.mlflow_run" class="md-nav__link">
    mlflow_run()
  </a>
  
    <nav class="md-nav" aria-label="mlflow_run()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initializing-the-nested-mlflow-run" class="md-nav__link">
    Initializing the nested MLFlow run
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.start_pipeline" class="md-nav__link">
    src.utils.start_pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.start_pipeline.start_pipeline" class="md-nav__link">
    start_pipeline()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    Report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.report.visualize" class="md-nav__link">
    src.report.visualize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.report.visualize.plot_confusion_matrix" class="md-nav__link">
    plot_confusion_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stages" class="md-nav__link">
    Stages
  </a>
  
    <nav class="md-nav" aria-label="Stages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-load" class="md-nav__link">
    Data Load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_load" class="md-nav__link">
    src.stages.data_load
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_load.data_load" class="md-nav__link">
    data_load()
  </a>
  
    <nav class="md-nav" aria-label="data_load()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-split" class="md-nav__link">
    Data Split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_split" class="md-nav__link">
    src.stages.data_split
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.data_split.data_split" class="md-nav__link">
    data_split()
  </a>
  
    <nav class="md-nav" aria-label="data_split()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    Evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.evaluate" class="md-nav__link">
    src.stages.evaluate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.evaluate.evaluate_model" class="md-nav__link">
    evaluate_model()
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#featurize" class="md-nav__link">
    Featurize
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.featurize" class="md-nav__link">
    src.stages.featurize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.featurize.featurize" class="md-nav__link">
    featurize()
  </a>
  
    <nav class="md-nav" aria-label="featurize()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#train" class="md-nav__link">
    Train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.train" class="md-nav__link">
    src.stages.train
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.stages.train.train_model" class="md-nav__link">
    train_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-submodule" class="md-nav__link">
    Train Submodule
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train" class="md-nav__link">
    src.train.train
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train.get_supported_estimator" class="md-nav__link">
    get_supported_estimator()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.train.train.train" class="md-nav__link">
    train()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
    <nav class="md-nav" aria-label="Utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs" class="md-nav__link">
    src.utils.logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs.get_console_handler" class="md-nav__link">
    get_console_handler()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.logs.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
    <nav class="md-nav" aria-label="get_logger()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mlflow-decorator" class="md-nav__link">
    MLFlow Decorator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.mlflow_run_decorator" class="md-nav__link">
    src.utils.mlflow_run_decorator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.mlflow_run_decorator.mlflow_run" class="md-nav__link">
    mlflow_run()
  </a>
  
    <nav class="md-nav" aria-label="mlflow_run()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initializing-the-nested-mlflow-run" class="md-nav__link">
    Initializing the nested MLFlow run
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.start_pipeline" class="md-nav__link">
    src.utils.start_pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.utils.start_pipeline.start_pipeline" class="md-nav__link">
    start_pipeline()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="reference">Reference</h1>
<h2 id="report">Report</h2>


<div class="doc doc-object doc-module">


<a id="src.report.visualize"></a>
  <div class="doc doc-contents first">
  
      <p>Module for visualization of confusion matrix, that is part of the report
produced by the pipeline.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.report.visualize.plot_confusion_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">target_names</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confusion matrix&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given a sklearn confusion matrix (cm), make a plot.</p>
<p>Usage:
   plot_confusion_matrix(cm = cm, normalize = True, target_names = y_labels_vals, title = best_estimator_name)</p>
<div class="highlight"><pre><span></span><code>Citation:
http://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cm</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td><p>confusion matrix from sklearn.metrics.confusion_matrix</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_names</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Text">Text</span>]</code>
          </td>
          <td><p>given classification classes such as [0, 1, 2] 
                       the class names, for example: ['high', 'medium', 'low']</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>the text to display at the top of the matrix. Defaults to 'Confusion matrix'.</p></td>
          <td>
                <code>&#39;Confusion matrix&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>cmap</code></td>
          <td>
                <code><span title="matplotlib.colors">matplotlib</span>.<span title="matplotlib.colors.colors">colors</span>.<span title="matplotlib.colors.LinearSegmentedColormap">LinearSegmentedColormap</span></code>
          </td>
          <td><p>the gradient of the values displayed from matplotlib.pyplot.cm
      see http://matplotlib.org/examples/color/colormaps_reference.html
      plt.get_cmap('jet') or plt.cm.Blues. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>normalize</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If False, plot the raw numbers. If True, plot the proportions. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="matplotlib.pyplot">plt</span>.<span title="matplotlib.pyplot.figure">figure</span></code>
          </td>
          <td><p>plt.gfc (plt.figure): plotted confusion matrix</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\report\visualize.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                          <span class="n">target_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Text</span><span class="p">],</span>
                          <span class="n">title</span><span class="p">:</span> <span class="n">Text</span> <span class="o">=</span> <span class="s1">&#39;Confusion matrix&#39;</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Given a sklearn confusion matrix (cm), make a plot.</span>

<span class="sd">       Usage:</span>
<span class="sd">       plot_confusion_matrix(cm = cm, normalize = True, target_names = y_labels_vals, title = best_estimator_name)</span>

<span class="sd">        Citation:</span>
<span class="sd">        http://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html</span>

<span class="sd">    Args:</span>
<span class="sd">        cm (np.array): confusion matrix from sklearn.metrics.confusion_matrix</span>
<span class="sd">        target_names (List[Text]): given classification classes such as [0, 1, 2] </span>
<span class="sd">                                   the class names, for example: [&#39;high&#39;, &#39;medium&#39;, &#39;low&#39;]</span>
<span class="sd">        title (Text, optional): the text to display at the top of the matrix. Defaults to &#39;Confusion matrix&#39;.</span>
<span class="sd">        cmap (matplotlib.colors.LinearSegmentedColormap, optional): the gradient of the values displayed from matplotlib.pyplot.cm</span>
<span class="sd">                  see http://matplotlib.org/examples/color/colormaps_reference.html</span>
<span class="sd">                  plt.get_cmap(&#39;jet&#39;) or plt.cm.Blues. Defaults to None.</span>
<span class="sd">        normalize (bool, optional): If False, plot the raw numbers. If True, plot the proportions. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plt.gfc (plt.figure): plotted confusion matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cm</span><span class="p">))</span>
    <span class="n">misclass</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">accuracy</span>

    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">target_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tick_marks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_names</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">target_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">target_names</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1.5</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:0.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True label&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label</span><span class="se">\n</span><span class="s1">accuracy=</span><span class="si">{:0.4f}</span><span class="s1">; misclass=</span><span class="si">{:0.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">accuracy</span><span class="p">,</span> <span class="n">misclass</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="stages">Stages</h2>
<h3 id="data-load">Data Load</h3>


<div class="doc doc-object doc-module">


<a id="src.stages.data_load"></a>
  <div class="doc doc-contents first">
  
      <p>Module for the data loading stage.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.stages.data_load.data_load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">data_load</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load raw data.</p>
<p>Depending on the parameter revision_on (taken from config),
   a specific version of data is loaded from the DVC repo.
   Othewise, the iris dataset is loaded from sklearn.datasets.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\stages\data_load.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@mlflow_run</span>
<span class="k">def</span> <span class="nf">data_load</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load raw data.</span>

<span class="sd">       Depending on the parameter revision_on (taken from config),</span>
<span class="sd">       a specific version of data is loaded from the DVC repo.</span>
<span class="sd">       Othewise, the iris dataset is loaded from sklearn.datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;DATA_LOAD&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Get dataset&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;revision_on&#39;</span><span class="p">]:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Grab dataset version </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]))</span>
        <span class="n">data_url</span> <span class="o">=</span> <span class="n">dvc</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;dataset_csv&#39;</span><span class="p">],</span>
            <span class="n">repo</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;repo&#39;</span><span class="p">],</span>
            <span class="n">rev</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="c1"># log data url and version tag in mlflow</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;data_url&#39;</span><span class="p">,</span> <span class="n">data_url</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">(</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">colname</span><span class="p">:</span> <span class="n">colname</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; (cm)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save raw data&#39;</span><span class="p">)</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;dataset_csv&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;input_rows&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;input_cols&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="data-split">Data Split</h3>


<div class="doc doc-object doc-module">


<a id="src.stages.data_split"></a>
  <div class="doc doc-contents first">
  
      <p>Module for the data split stage.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.stages.data_split.data_split" class="doc doc-heading">
<code class="highlight language-python"><span class="n">data_split</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Split the featurized dataset into train/test.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\stages\data_split.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@mlflow_run</span>
<span class="k">def</span> <span class="nf">data_split</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Split the featurized dataset into train/test.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;DATA_SPLIT&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Load features&#39;</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;featurize&#39;</span><span class="p">][</span><span class="s1">&#39;features_path&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Split features into train and test sets&#39;</span><span class="p">)</span>
    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">test_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_split&#39;</span><span class="p">][</span><span class="s1">&#39;test_size&#39;</span><span class="p">],</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;random_state&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save train and test sets&#39;</span><span class="p">)</span>
    <span class="n">train_csv_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_split&#39;</span><span class="p">][</span><span class="s1">&#39;trainset_path&#39;</span><span class="p">]</span>
    <span class="n">test_csv_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_split&#39;</span><span class="p">][</span><span class="s1">&#39;testset_path&#39;</span><span class="p">]</span>
    <span class="n">train_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">train_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">test_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">test_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;test_size&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;featurize&#39;</span><span class="p">][</span><span class="s1">&#39;features_path&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="evaluation">Evaluation</h3>


<div class="doc doc-object doc-module">


<a id="src.stages.evaluate"></a>
  <div class="doc doc-contents first">
  
      <p>Module for evaluation stage of trained model.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.stages.evaluate.evaluate_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate_model</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Evaluate the trained model.</p>
<p>Load the trained model and the test set via the path specification in
   the config file. Do the prediction on the test set, compute its f1 score 
   and plot the confusion matrix. Both are saved in the reports folder.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\stages\evaluate.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@mlflow_run</span>
<span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Evaluate the trained model.</span>

<span class="sd">       Load the trained model and the test set via the path specification in</span>
<span class="sd">       the config file. Do the prediction on the test set, compute its f1 score </span>
<span class="sd">       and plot the confusion matrix. Both are saved in the reports folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;EVALUATE&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Load model&#39;</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;model_path&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Load test dataset&#39;</span><span class="p">)</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_split&#39;</span><span class="p">][</span><span class="s1">&#39;testset_path&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Evaluate (build report)&#39;</span><span class="p">)</span>
    <span class="n">target_column</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;featurize&#39;</span><span class="p">][</span><span class="s1">&#39;target_column&#39;</span><span class="p">]</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target_column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
        <span class="s1">&#39;cm&#39;</span><span class="p">:</span> <span class="n">cm</span><span class="p">,</span>
        <span class="s1">&#39;actual&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
        <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">prediction</span>
    <span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save metrics&#39;</span><span class="p">)</span>
    <span class="c1"># save f1 metrics file</span>
    <span class="n">reports_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluate&#39;</span><span class="p">][</span><span class="s1">&#39;reports_dir&#39;</span><span class="p">])</span>
    <span class="n">metrics_path</span> <span class="o">=</span> <span class="n">reports_folder</span> <span class="o">/</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluate&#39;</span><span class="p">][</span><span class="s1">&#39;metrics_file&#39;</span><span class="p">]</span>

    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
        <span class="n">obj</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;f1_score&#39;</span><span class="p">:</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]},</span>
        <span class="n">fp</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">metrics_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;F1 metrics file saved to : </span><span class="si">{</span><span class="n">metrics_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save confusion matrix&#39;</span><span class="p">)</span>
    <span class="c1"># save confusion_matrix.png</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;cm&#39;</span><span class="p">],</span>
                                <span class="n">target_names</span><span class="o">=</span><span class="n">load_iris</span><span class="p">(</span>
                                    <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">target_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                                <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">confusion_matrix_png_path</span> <span class="o">=</span> <span class="n">reports_folder</span> <span class="o">/</span> \
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluate&#39;</span><span class="p">][</span><span class="s1">&#39;confusion_matrix_image&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">confusion_matrix_png_path</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Confusion matrix saved to : </span><span class="si">{</span><span class="n">confusion_matrix_png_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;f1_test&#39;</span><span class="p">,</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="featurize">Featurize</h3>


<div class="doc doc-object doc-module">


<a id="src.stages.featurize"></a>
  <div class="doc doc-contents first">
  
      <p>Module for featurization stage of raw data sets.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.stages.featurize.featurize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">featurize</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create new features and save the processed dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\stages\featurize.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@mlflow_run</span>
<span class="k">def</span> <span class="nf">featurize</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create new features and save the processed dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;FEATURIZE&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Load raw data&#39;</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_load&#39;</span><span class="p">][</span><span class="s1">&#39;dataset_csv&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Extract features&#39;</span><span class="p">)</span>
    <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sepal_length_to_sepal_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">]</span> <span class="o">/</span> \
        <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sepal_width&#39;</span><span class="p">]</span>
    <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;petal_length_to_petal_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;petal_length&#39;</span><span class="p">]</span> <span class="o">/</span> \
        <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;petal_width&#39;</span><span class="p">]</span>
    <span class="n">featured_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span>
        <span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;sepal_width&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_width&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sepal_length_to_sepal_width&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_length_to_petal_width&#39;</span><span class="p">,</span>
        <span class="s1">&#39;target&#39;</span>
    <span class="p">]]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save features&#39;</span><span class="p">)</span>
    <span class="n">features_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;featurize&#39;</span><span class="p">][</span><span class="s1">&#39;features_path&#39;</span><span class="p">]</span>
    <span class="n">featured_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">features_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="n">featured_dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="train">Train</h3>


<div class="doc doc-object doc-module">


<a id="src.stages.train"></a>
  <div class="doc doc-contents first">
  
      <p>Module for the training stage.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.stages.train.train_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Train model.</p>
<p>Train the model on the train set. Get the path to the data and the
   parametrization for the model used from the config.</p>
<p>This stage uses a helper function that does a GridSearchCV,
   with the intend of further modularization and higher flexibility of
   this script. </p>
<p>The best model is saved to the models directory as a joblib file.
   In addition, the model is logged via mlflow. </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\stages\train.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@mlflow_run</span>
<span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Train model.</span>

<span class="sd">       Train the model on the train set. Get the path to the data and the</span>
<span class="sd">       parametrization for the model used from the config.</span>

<span class="sd">       This stage uses a helper function that does a GridSearchCV,</span>
<span class="sd">       with the intend of further modularization and higher flexibility of</span>
<span class="sd">       this script. </span>

<span class="sd">       The best model is saved to the models directory as a joblib file.</span>
<span class="sd">       In addition, the model is logged via mlflow. </span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;TRAIN&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Get estimator name&#39;</span><span class="p">)</span>
    <span class="n">estimator_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;estimator_name&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estimator: </span><span class="si">{</span><span class="n">estimator_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Load train dataset&#39;</span><span class="p">)</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_split&#39;</span><span class="p">][</span><span class="s1">&#39;trainset_path&#39;</span><span class="p">])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Train model&#39;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span>
        <span class="n">target_column</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;featurize&#39;</span><span class="p">][</span><span class="s1">&#39;target_column&#39;</span><span class="p">],</span>
        <span class="n">estimator_name</span><span class="o">=</span><span class="n">estimator_name</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;estimators&#39;</span><span class="p">][</span><span class="n">estimator_name</span><span class="p">][</span><span class="s1">&#39;param_grid&#39;</span><span class="p">],</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;cv&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best score: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">best_score_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save model&#39;</span><span class="p">)</span>
    <span class="n">models_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;model_path&#39;</span><span class="p">]</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">models_path</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;chosen_estimator&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;parametrization&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;F1&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="train-submodule">Train Submodule</h2>


<div class="doc doc-object doc-module">


<a id="src.train.train"></a>
  <div class="doc doc-contents first">
  
      <p>Contains the submodule for training the model. Consider adding more options.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.train.train.get_supported_estimator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_supported_estimator</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return a list of supported classifiers.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Dict</code></td>          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>supported classifiers</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\train\train.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_supported_estimator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return a list of supported classifiers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict: supported classifiers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;logreg&#39;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">,</span>
        <span class="s1">&#39;svm&#39;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">,</span>
        <span class="s1">&#39;knn&#39;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.train.train.train" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_column</span><span class="p">,</span> <span class="n">estimator_name</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Train model via GridSearchCV.</p>
<p>First, check if the estimator handed to this function is supported by the
   GridSearchCV subroutine. If so, do the gridsearch and return the fitted
   object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataset</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_column</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>target column name</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>estimator_name</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>estimator name</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>param_grid</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>grid parameters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cv</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>cross-validation value</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="src.train.train.UnsupportedClassifier">UnsupportedClassifier</span></code>
          </td>
          <td><p>Raise an error if estimator is not supported by 
                   this train routine.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>clf</code></td>          <td>
                <code>sklearn.<span title="sklearn.grid_search">grid_search</span></code>
          </td>
          <td><p>trained model</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\train\train.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_column</span><span class="p">:</span> <span class="n">Text</span><span class="p">,</span>
          <span class="n">estimator_name</span><span class="p">:</span> <span class="n">Text</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>  <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Train model via GridSearchCV.</span>

<span class="sd">       First, check if the estimator handed to this function is supported by the</span>
<span class="sd">       GridSearchCV subroutine. If so, do the gridsearch and return the fitted</span>
<span class="sd">       object.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): dataset</span>
<span class="sd">        target_column (Text): target column name</span>
<span class="sd">        estimator_name (Text): estimator name</span>
<span class="sd">        param_grid (Dict): grid parameters</span>
<span class="sd">        cv (int): cross-validation value</span>

<span class="sd">    Raises:</span>
<span class="sd">        UnsupportedClassifier: Raise an error if estimator is not supported by </span>
<span class="sd">                               this train routine.</span>

<span class="sd">    Returns:</span>
<span class="sd">        clf (sklearn.grid_search): trained model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">estimators</span> <span class="o">=</span> <span class="n">get_supported_estimator</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">estimator_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">estimators</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">UnsupportedClassifier</span><span class="p">(</span><span class="n">estimator_name</span><span class="p">)</span>

    <span class="n">estimator</span> <span class="o">=</span> <span class="n">estimators</span><span class="p">[</span><span class="n">estimator_name</span><span class="p">]()</span>
    <span class="n">f1_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
                       <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                       <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">scoring</span><span class="o">=</span><span class="n">f1_scorer</span><span class="p">)</span>
    <span class="c1"># Get X and Y</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target_column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">clf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="utils">Utils</h2>
<h3 id="logging">Logging</h3>


<div class="doc doc-object doc-module">


<a id="src.utils.logs"></a>
  <div class="doc doc-contents first">
  
      <p>Provides functions to create loggers.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.utils.logs.get_console_handler" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_console_handler</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get console handler.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>logging.<span title="logging.StreamHandler">StreamHandler</span></code>
          </td>
          <td><p>logging.StreamHandler: log into stdout</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\utils\logs.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_console_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get console handler.</span>

<span class="sd">    Returns:</span>
<span class="sd">        logging.StreamHandler: log into stdout</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> — </span><span class="si">%(name)s</span><span class="s2"> — </span><span class="si">%(levelname)s</span><span class="s2"> — </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">console_handler</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.utils.logs.get_logger" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get logger.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>logger name. Defaults to <strong>name</strong>.</p></td>
          <td>
                <code>__name__</code>
          </td>
        </tr>
        <tr>
          <td><code>log_level</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Text">Text</span>, int]</code>
          </td>
          <td><p>logging level; can be string name or integer value. Defaults to logging.DEBUG.</p></td>
          <td>
                <code>logging.DEBUG</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>logging.Logger: logger instance</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\utils\logs.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">Text</span> <span class="o">=</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">log_level</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get logger.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (Text, optional): logger name. Defaults to __name__.</span>
<span class="sd">        log_level (Union[Text, int], optional): logging level; can be string name or integer value. Defaults to logging.DEBUG.</span>

<span class="sd">    Returns:</span>
<span class="sd">        logging.Logger: logger instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Prevent duplicate outputs in Jypyter Notebook</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">get_console_handler</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="mlflow-decorator">MLFlow Decorator</h3>


<div class="doc doc-object doc-module">


<a id="src.utils.mlflow_run_decorator"></a>
  <div class="doc doc-contents first">
  
      <p>Module for creating the MLFlow nested run decorator.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.utils.mlflow_run_decorator.mlflow_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mlflow_run</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Decorator to turn every stage into MLflow nested run.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wrapped_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td><p>the respective function in each stage</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td><p>wrapped function (Callable): the input function, tracked under the respective MLFLOW_RUN_ID</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\utils\mlflow_run_decorator.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mlflow_run</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Decorator to turn every stage into MLflow nested run.</span>

<span class="sd">    Args:</span>
<span class="sd">        wrapped_function (Callable): the respective function in each stage</span>

<span class="sd">    Returns:</span>
<span class="sd">        wrapped function (Callable): the input function, tracked under the respective MLFLOW_RUN_ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="s1">&#39;params.yaml&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;project_experiment_name&#39;</span><span class="p">])</span>
        <span class="c1"># recover parent run thanks to MLFLOW_RUN_ID env variable</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
            <span class="c1"># start child run</span>
            <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">wrapped_function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="initializing-the-nested-mlflow-run">Initializing the nested MLFlow run</h3>


<div class="doc doc-object doc-module">


<a id="src.utils.start_pipeline"></a>
  <div class="doc doc-contents first">
  
      <p>Module for initializing nested MLFlow run.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.utils.start_pipeline.start_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">start_pipeline</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Start a new MLflow run each time we launch the DVC pipeline.</p>
<p>Print the MLFLOW_RUN_ID and save as an environment variable. 
   This allows the possibility to track nested runs for each stage
   of the pipeline.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="typing.Text">Text</span></code>
          </td>
          <td><p>path to config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>run_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>specify run name</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\utils\start_pipeline.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_pipeline</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="n">Text</span><span class="p">,</span> <span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Start a new MLflow run each time we launch the DVC pipeline.</span>

<span class="sd">       Print the MLFLOW_RUN_ID and save as an environment variable. </span>
<span class="sd">       This allows the possibility to track nested runs for each stage</span>
<span class="sd">       of the pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Text): path to config</span>
<span class="sd">        run_name (str): specify run name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">][</span><span class="s1">&#39;project_experiment_name&#39;</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">run_name</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">active_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s1">&#39;dvc.yaml&#39;</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Start" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Start
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.85cb4492.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f758a944.min.js"></script>
      
    
  </body>
</html>